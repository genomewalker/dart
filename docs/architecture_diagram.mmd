%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f7f7f7', 'primaryBorderColor': '#525252', 'secondaryColor': '#f7f7f7', 'secondaryBorderColor': '#525252', 'tertiaryColor': '#f7f7f7', 'lineColor': '#525252', 'textColor': '#1a1a1a', 'fontSize': '13px', 'fontFamily': 'Helvetica, Arial, sans-serif'}}}%%

flowchart LR
    subgraph P1["Pass 1: Sample Profiling"]
        direction TB
        F1[FASTQ] --> CA["Channel A<br/><small>T/(T+C)</small>"]
        F1 --> CB["Channel B<br/><small>stop conversion</small>"]
        CA --> PR["d<sub>max</sub>, Î»"]
        CB --> PR
    end

    subgraph P2["Pass 2: Gene Prediction"]
        direction TB
        F2[FASTQ] --> DM["Damage model"]
        F2 --> FS["Frame selection"]
        DM --> PREAD["p<sub>read</sub>"]
        FS --> PREAD
        PREAD --> OUT["GFF3<br/>FASTA<br/>.agd"]
    end

    PR -.->|"profile"| F2

    style P1 fill:#fff8f0,stroke:#d97706,stroke-width:1.5px
    style P2 fill:#f0fdf4,stroke:#15803d,stroke-width:1.5px
    style CA fill:#fef3c7,stroke:#d97706,stroke-width:1px
    style CB fill:#dcfce7,stroke:#15803d,stroke-width:1px
    style DM fill:#dbeafe,stroke:#1d4ed8,stroke-width:1px
    style FS fill:#f3e8ff,stroke:#7c3aed,stroke-width:1px
    style PREAD fill:#dbeafe,stroke:#1d4ed8,stroke-width:1px
    style F1 fill:#ffffff,stroke:#737373,stroke-width:1px
    style F2 fill:#ffffff,stroke:#737373,stroke-width:1px
    style PR fill:#f5f5f5,stroke:#737373,stroke-width:1px
    style OUT fill:#f5f5f5,stroke:#737373,stroke-width:1px
